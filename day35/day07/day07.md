# Node.js第7天

## 接口(API)

接口：就是后端为前端提供的动态资源；

Node.js下每一个路由都会产生一个对应的接口

### 1.返回结果

   格式上要求是JSON对象的形式，包括状态码、消息说明

   JSON:  字符串对象（把对象放入到字符串中），属性名必须是双引号，属性值是字符串也必须是双引号

```
{
	"code": 200,
	"msg": "员工添加成功",
	"data": 需要返回的数据
}
```

### 2.接口地址



### 3.请求方式

  get     用于获取资源(查询数据)

  post     用于新建资源(插入数据)

  delete    用于删除资源(删除数据)

  put     用于修改资源(修改数据)

### 4.传递参数

  get/delete     选择get传递 (可选params传递)

  post/put     选择post传递

  

练习：编写删除员工接口(delete  /del)，使用get方式传递员工的编号，获取传递的编号，如果删除失败响应 {code: 400, msg: '删除失败'} ，否则删除成功响应 {code: 200, msg: '删除成功'}

使用接口测试工具测试接口

练习：编写修改员工接口(put  /update)，使用post方式传递员工的编号、姓名、性别、生日、工资、部门编号；获取传递的参数，执行SQL命令，如果修改失败响应{code: 400, msg: '修改失败'}，否则修改成功响应 {code: 200,msg:'修改成功'}

练习：编写员工列表接口(get  /list)，使用get传递当前的页码和每页的数据量；获取传递的参数，执行SQL命令，响应{code: 200, msg: '员工列表', data:查询的这一页数据}

练习：编写部门模块路由器dept.js，创建路由器对象，编写添加部门接口(post  /add)，暴露路由器对象；在WEB下引入并挂载，添加前缀/dept。

添加部门接口，获取传递的部门名称，执行SQL命令，插入数据；响应{code: 200, msg: '部门添加成功'}



练习：编写删除部门的接口(delete  /del)，get传递部门的编号，执行SQL命令，如果删除失败响应{code: 400, msg:'删除失败'}  否则{code:200,msg:'删除成功'}

练习：编写修改部门的接口(put  /update)，post传递部门的编号，部门名称，执行SQL命令，如果修改失败响应 {code: 400, msg: '修改失败'}  否则{code: 200, msg: '修改成功'}















> Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client
>

以上这个错误，说明响应了多次造成的，例如：多次调用了send方法

## 错误处理中间件

在所有路由器(路由)后添加，拦截所有路由中出现的错误

```js
app.use( (err, req, res, next) => {
    // err 路由传递的错误
    res.send({code: 500, msg: '服务器端错误'})
} )
```

